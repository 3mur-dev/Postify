<!-- fragments/navbar.html -->
<div th:fragment="navbar">
  <header class="bg-white shadow">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between gap-4">

        <!-- Logo -->
        <h1 class="text-2xl font-bold text-indigo-600">
          <a th:href="@{/}" class="hover:text-indigo-700">Postify</a>
        </h1>

        <!-- Mobile toggle -->
        <label for="navMenuToggle" class="md:hidden cursor-pointer p-2 rounded-lg border border-gray-200 text-gray-700">
          â˜°
        </label>
      </div>

      <!-- Hidden checkbox controls mobile menu -->
      <input type="checkbox" id="navMenuToggle" class="hidden peer/nav">

      <div class="mt-4 md:mt-0 md:flex md:items-center md:justify-between md:gap-6
                  hidden peer-checked/nav:block">

        <!-- Search form -->
        <form th:action="@{/search}" method="get"
              class="flex w-full md:w-auto items-center gap-2 mb-3 md:mb-0">
          <input type="text" name="q" placeholder="Search users..."
                 class="flex-1 md:w-72 px-3 py-2 rounded-xl border focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
          <button type="submit"
                  class="bg-indigo-500 text-white px-4 py-2 rounded-xl hover:bg-indigo-600 transition w-full md:w-auto">
            Search
          </button>
        </form>

        <!-- Navigation links -->
        <nav class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">

          <!-- Always visible Home link -->
          <a th:href="@{/}" class="text-gray-700 hover:text-indigo-600 font-medium">Home</a>

          <!-- Guest links -->
          <a th:if="${currentUser == null}" th:href="@{/login}"
             class="text-gray-700 hover:text-indigo-600 font-medium">Login</a>
          <a th:if="${currentUser == null}" th:href="@{/register}"
             class="text-gray-700 hover:text-indigo-600 font-medium">Register</a>

          <!-- Logged-in user avatar dropdown (CSS-only) -->
          <div th:if="${currentUser != null}" class="relative">

            <!-- Hidden checkbox toggle -->
            <input type="checkbox" id="navToggle" class="hidden peer/user">

            <!-- Avatar label (click toggles checkbox) -->
            <label for="navToggle"
                   class="cursor-pointer inline-flex items-center">
              <img th:src="${currentUser.avatarUrl != null ? currentUser.avatarUrl : '/images/default-avatar.png'}"
                   class="w-10 h-10 rounded-full border-2 border-indigo-500 hover:ring-2 hover:ring-indigo-400"
                   alt="Profile"/>
            </label>

            <!-- Dropdown menu -->
            <div class="absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-lg py-2 z-10
                        opacity-0 pointer-events-none transition-all duration-200
                        peer-checked/user:opacity-100 peer-checked/user:pointer-events-auto">

              <!-- Profile link -->
              <a th:href="@{'/profile/' + ${currentUser.username}}"
                 class="block px-4 py-2 hover:bg-gray-100">
                Profile
              </a>

              <!-- Edit profile link -->
              <a th:href="@{/profile/edit}"
                 class="block px-4 py-2 hover:bg-gray-100">
                Edit Profile
              </a>

              <!-- Logout link -->
              <a th:href="@{/logout}"
                 class="block px-4 py-2 hover:bg-gray-100">
                Logout
              </a>

            </div>
          </div>

        </nav>
      </div>
    </div>
  </header>
</div>
