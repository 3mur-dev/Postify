<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${pageTitle}">Home - Postify</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen relative">

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Main Container -->
<div class="max-w-2xl mx-auto mt-8 px-4">

  <!-- Posts Feed -->
  <div th:each="post : ${posts}"
       class="bg-white p-5 rounded-2xl shadow-md mb-6">

    <!-- Post Header -->
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <img th:src="${post.user.avatarUrl != null ? post.user.avatarUrl : '/images/default-avatar.png'}"
             class="w-10 h-10 rounded-full border-2 border-indigo-500"/>

        <a th:href="@{'/profile/' + ${post.user.username}}"
           class="font-semibold text-gray-800 hover:text-indigo-600"
           th:text="${post.user.username}"></a>
      </div>

      <!-- Delete Button -->
      <div th:if="${currentUser != null and currentUser.username == post.user.username}">
        <form th:action="@{/posts/delete/{id}(id=${post.id})}" method="post">
          <button type="submit"
                  class="px-3 py-1 bg-red-100 text-red-600 font-semibold rounded-lg hover:bg-red-200 hover:text-red-700 transition">
            Delete
          </button>
        </form>
      </div>
    </div>

    <!-- Post Content -->
    <p class="mt-4 text-gray-700 text-base"
       th:if="${post.content != null}"
       th:text="${post.content}"></p>

    <!-- Post Image -->
    <div th:if="${post.imageUrl != null}" class="mt-4">
      <img th:src="${post.imageUrl}"
           class="w-full rounded-2xl border border-gray-200 object-cover"
           alt="Post image"/>
    </div>

    <!-- Timestamp -->
    <div class="text-sm text-gray-400 mt-2"
         th:text="${#temporals.format(post.createdAt, 'dd MMM yyyy HH:mm')}"></div>

    <!-- Like Section -->
    <div class="flex items-center mt-4 space-x-3"
         th:if="${currentUser != null}">
      <form th:action="@{/posts/{postId}/like(postId=${post.id})}" method="post">
        <button type="submit"
                class="flex items-center space-x-2 px-4 py-1 rounded-xl transition"
                th:classappend="${likeService.isLikedByUser(post, currentUser) ? ' bg-pink-100 text-pink-600' : ' bg-gray-100 text-gray-600 hover:bg-gray-200'}">
          <span th:text="${likeService.isLikedByUser(post, currentUser) ? 'â¤ï¸' : 'ðŸ¤'}"></span>
          <span th:text="${likeService.countLikes(post)}"></span>
        </button>
      </form>
    </div>

  </div>

  <!-- Load More -->
  <div th:if="${posts.hasNext()}"
       class="flex justify-center mb-10">
    <form th:action="@{/}" method="get" class="flex">
      <input type="hidden" name="page" th:value="${posts.number + 1}"/>
      <input type="hidden" name="size" th:value="${pageSize}"/>
      <input type="hidden" name="keyword" th:value="${keyword}"/>
      <button type="submit"
              class="px-5 py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition">
        Load more
      </button>
    </form>
  </div>

</div>

<!-- ============================== -->
<!-- Floating + Add Post Button (CSS-only Modal) -->
<!-- ============================== -->

<!-- Hidden checkbox toggle -->
<input type="checkbox" id="addPostToggle" class="hidden peer">

<!-- Floating + button -->
<label for="addPostToggle"
       class="fixed bottom-8 right-8 w-14 h-14 bg-indigo-600 text-white text-3xl rounded-full shadow-lg flex items-center justify-center cursor-pointer hover:bg-indigo-700 active:scale-95 transition-all duration-200 peer-checked:bg-indigo-800">
  +
</label>

<!-- Modal Overlay -->
<div class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300
            peer-checked:pointer-events-auto peer-checked:opacity-100">
  <div class="bg-white w-full max-w-lg p-6 rounded-3xl shadow-2xl relative">

    <label for="addPostToggle"
           class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-xl cursor-pointer">
      âœ•
    </label>

    <h2 class="text-xl font-semibold mb-4">Create Post</h2>

    <form th:action="@{/posts/create}" method="post" enctype="multipart/form-data">
      <textarea name="content"
                rows="4"
                placeholder="What's on your mind?"
                class="w-full p-4 border rounded-2xl focus:ring-2 focus:ring-indigo-400 resize-none"
                ></textarea>

      <div class="mt-3">
        <label class="block text-sm font-medium text-gray-700 mb-1">Attach image (optional)</label>
        <input type="file" name="image" accept="image/*"
               class="w-full text-sm text-gray-700 file:mr-3 file:py-2 file:px-4 file:rounded-xl file:border-0 file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200"/>
      </div>

      <div class="flex justify-end mt-4">
        <button type="submit"
                class="px-5 py-2 bg-indigo-600 text-white rounded-2xl hover:bg-indigo-700 transition">
          Post
        </button>
      </div>
    </form>

  </div>
</div>

</body>
</html>
